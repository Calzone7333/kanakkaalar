import{j as e}from"./ui-B7g2UBO6.js";import{r as o,h as ae,b as re}from"./vendor-BMI_syx-.js";import{o as u,g as E,p as D}from"./index-BDeliUZK.js";import{F as L}from"./CloudArrowUpIcon-BR0FpVjA.js";import{F as $,a as N}from"./ShieldCheckIcon-BeV2yfci.js";import{F as Y}from"./CurrencyRupeeIcon-BnFNQZjf.js";import{F as oe}from"./ArrowDownTrayIcon-wfyR4S1w.js";import"./utils-Dw7OLvbZ.js";function le({title:d,titleId:m,...l},w){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:w,"aria-labelledby":m},l),d?o.createElement("title",{id:m},d):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const ne=o.forwardRef(le),ie=d=>new Promise(m=>{const l=document.createElement("script");l.src=d,l.onload=()=>m(!0),l.onerror=()=>m(!1),document.body.appendChild(l)}),de={"GST Registration":["PAN Card of Applicant/Directors","Aadhar Card of Applicant/Directors","Passport Size Photo","Business Address Proof (Electricity Bill / Rent Agreement + NOC)","Bank Account Statement / Cancelled Cheque"],"MSME Registration":["Aadhar Card of Applicant","PAN Card of Applicant","Business Address Proof"],"Trademark Registration":["Logo or Brand Name Representation","Signed Power of Attorney (Form 48)","Identity Proof of Applicant","Address Proof of Applicant"],"Private Limited Company Registration":["PAN Card of all Directors","Aadhar Card/Passport/Voter ID of all Directors","Passport Size Photos","Business Address Proof (Utility Bill)","NOC from Owner"],"Import Export Code Registration (IEC)":["PAN Card of Individual/Company","Aadhar Card/Voter ID/Passport","Cancelled Cheque of Current Account","Rent Agreement/Electricity Bill"]},ce=["Identity Proof (PAN/Aadhar)","Address Proof","Passport Size Photo"];function be(){var B,M;const[d]=ae(),m=re(),l=d.get("title")||"Service",w=d.get("desc")||"Complete your application.",v=499,P=d.get("orderId"),[g,I]=o.useState([]),[s,A]=o.useState(null),[y,Z]=o.useState([]),[b,n]=o.useState(!1),[F,r]=o.useState(""),[c,x]=o.useState(1),[k,q]=o.useState(!1),[z,K]=o.useState(!1),V=s&&s.id,O=y.length>0,j=(s==null?void 0:s.serviceName)||l,G=de[j]||ce,C=o.useCallback(async()=>{if(!(!s||!s.id))try{const t=await u.listDocuments(s.id);Z(t.data||[])}catch(t){console.warn("Failed to fetch documents:",t)}},[s]);o.useEffect(()=>{s||(async()=>{var i;if(z)return;K(!0);const a=E();if(!((i=a==null?void 0:a.user)!=null&&i.email)){r("Please log in to continue.");return}n(!0);try{if(P){const h=await u.getById(P);A(h.data)}else{const h=await u.create({serviceName:l,customerEmail:a.user.email,totalAmount:v});A(h.data)}}catch{r("Failed to load application. Please try again.")}finally{n(!1)}})()},[l,z,s,P]),o.useEffect(()=>{s&&(C(),s.status==="PAYMENT_COMPLETED"||s.status==="PLACED"?x(4):s.status==="PENDING_PAYMENT"&&x(3))},[s,C]);const H=t=>{const a=Array.from(t.target.files||[]);I(i=>[...i,...a])},W=()=>{const t=document.createElement("a"),a=new Blob([`E-Agreement Content

Terms and Conditions...`],{type:"text/plain"});t.href=URL.createObjectURL(a),t.download="Service_Agreement.txt",document.body.appendChild(t),t.click(),q(!0),r("Agreement downloaded.")},Q=async()=>{if(!V)return r("Initializing... please wait.");if(g.length===0)return r("Please select files to upload.");n(!0);try{for(const t of g)await u.addDocument(s.id,t);I([]),await C(),r("Documents uploaded successfully.")}catch{r("Document upload failed.")}finally{n(!1)}},J=()=>{if(!O)return r("Please upload the required documents.");x(2)},X=async()=>{try{s&&s.id&&await u.update(s.id,{status:"PENDING_PAYMENT"}),x(3)}catch(t){console.error(t),x(3)}},ee=async()=>{var t,a;n(!0);try{if(!await ie("https://checkout.razorpay.com/v1/checkout.js")){r("Razorpay SDK failed to load."),n(!1);return}const f=(await D.getKey()).data;if(console.log("Razorpay Key ID:",f),!f||!f.startsWith("rzp_")){console.error("Invalid Razorpay Key Format:",f),r("System Error: Invalid Payment Configuration. Please contact support."),n(!1);return}const U=await D.createOrder({amount:Math.round(v*100),currency:"INR",description:`Payment for ${l}`});console.log("Order Response:",U.data);const{orderId:S}=U.data;if(!S)throw new Error("Invalid order ID received from backend");const T={key:f,name:"Calzone Financial",description:l,order_id:S,handler:async function(p){try{console.log("Payment Success:",p),await D.confirm({orderId:S,paymentId:p.razorpay_payment_id}),await u.pay(s.id,{paymentId:p.razorpay_payment_id});const R=await u.getById(s.id);A(R.data),x(4),r("Payment Successful! Application Submitted.")}catch(R){console.error("Payment Confirmation Failed:",R),r("Payment verification failed.")}},modal:{ondismiss:function(){n(!1),r("Payment cancelled.")}},prefill:{email:(a=(t=E())==null?void 0:t.user)==null?void 0:a.email},theme:{color:"#2563EB"}};console.log("Razorpay Options:",T);const _=new window.Razorpay(T);_.on("payment.failed",function(p){console.error("Payment Failed:",p.error),r(`Payment Failed: ${p.error.description}`),n(!1)}),_.open()}catch(i){r("Payment initiation failed. See console for details."),console.error("Payment Init Error:",i),n(!1)}},te=[{id:1,title:"Upload Documents",icon:L},{id:2,title:"Review Application",icon:$},{id:3,title:"Payment",icon:Y},{id:4,title:"Success",icon:N}],se=({stepId:t,title:a,icon:i})=>e.jsxs("div",{className:"flex flex-col items-center z-10",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all duration-300 ${c===t?"bg-blue-600 border-blue-600 text-white shadow-lg scale-110":c>t?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-400"}`,children:c>t?e.jsx(N,{className:"w-6 h-6"}):e.jsx(i,{className:"w-5 h-5"})}),e.jsx("p",{className:`mt-2 text-xs font-medium text-center whitespace-nowrap ${c>=t?"text-gray-800":"text-gray-400"}`,children:a})]});return e.jsxs("div",{className:"max-w-5xl p-6 mx-auto antialiased shadow-2xl bg-gray-50 rounded-xl min-h-[80vh]",children:[e.jsxs("div",{className:"p-6 mb-8 bg-white border-l-4 border-blue-600 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:j}),e.jsx("p",{className:"mt-2 text-gray-600",children:w})]}),e.jsxs("div",{className:"relative flex items-center justify-between px-4 mb-12",children:[e.jsx("div",{className:"absolute left-0 top-5 w-full h-0.5 bg-gray-200 -z-0"}),te.map(t=>e.jsx(se,{...t},t.id))]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[c===1&&e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsxs("div",{className:"md:w-1/3 bg-blue-50 p-6 rounded-xl border border-blue-100 h-fit",children:[e.jsxs("h3",{className:"flex items-center text-lg font-bold text-blue-900 mb-4",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Required Documents"]}),e.jsxs("ul",{className:"space-y-3",children:[G.map((t,a)=>e.jsxs("li",{className:"flex items-start text-sm text-blue-800",children:[e.jsx("span",{className:"mr-2 mt-1",children:"•"}),e.jsx("span",{children:t})]},a)),e.jsxs("li",{className:"flex items-start text-sm text-blue-800 font-semibold pt-2 border-t border-blue-200 mt-2",children:[e.jsx("span",{className:"mr-2 mt-1",children:"•"}),e.jsx("span",{children:"Signed E-Agreement"})]})]}),e.jsxs("button",{onClick:W,className:"mt-6 w-full flex items-center justify-center px-4 py-2 bg-white border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 text-sm font-medium transition",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"})," Download Agreement"]})]}),e.jsxs("div",{className:"md:w-2/3",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Upload Your Files"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Please upload the documents listed on the left. You can select multiple files at once."}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex gap-4 items-center",children:e.jsx("label",{className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"w-full border-2 border-dashed border-gray-300 rounded-lg p-6 flex flex-col items-center justify-center hover:border-blue-500 hover:bg-blue-50 transition",children:[e.jsx(L,{className:"w-8 h-8 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Click to select files"}),e.jsx("input",{type:"file",multiple:!0,onChange:H,className:"hidden"})]})})}),g.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Selected Files:"}),e.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:g.map((t,a)=>e.jsx("li",{children:t.name},a))}),e.jsx("button",{onClick:Q,disabled:b,className:"mt-4 px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:opacity-50 transition w-full",children:b?"Uploading...":"Upload Selected Files"})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-4",children:"Uploaded Successfully"}),y.length===0?e.jsx("p",{className:"text-gray-500 italic text-sm",children:"No documents uploaded yet."}):e.jsx("ul",{className:"space-y-2 mb-6",children:y.map(t=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-green-50 rounded border border-green-100",children:[e.jsx("span",{className:"text-sm text-gray-700",children:t.fileName}),e.jsx(N,{className:"w-5 h-5 text-green-600"})]},t.id))})]}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsx("button",{onClick:J,disabled:!O,className:"px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-300 transition",children:"Next: Review Application"})})]})]})}),c===2&&e.jsxs("div",{className:"p-8",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"Review Your Application"}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-6 mb-8 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Service Selected"}),e.jsx("p",{className:"font-semibold text-gray-800 text-lg",children:j})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Applicant Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:(M=(B=E())==null?void 0:B.user)==null?void 0:M.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Total Documents"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[y.length," Files"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"E-Agreement Status"}),e.jsx("p",{className:`font-semibold ${k?"text-green-600":"text-orange-500"}`,children:k?"Downloaded":"Not Downloaded"})]})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>x(1),className:"text-gray-500 hover:text-gray-700 font-medium px-4",children:"Back to Upload"}),e.jsxs("button",{onClick:X,className:"px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition shadow-md flex items-center",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Confirm & Proceed to Payment"]})]})]}),c===3&&e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Y,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Final Step: Payment"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"Pay the service fee to officially submit your application."}),e.jsxs("div",{className:"bg-white p-6 rounded-xl max-w-sm mx-auto mb-8 border-2 border-indigo-100 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-500 uppercase tracking-wide font-semibold mb-1",children:"Total Payable"}),e.jsxs("p",{className:"text-4xl font-bold text-indigo-600",children:["₹",v]})]}),e.jsx("button",{onClick:ee,disabled:b,className:"px-10 py-4 bg-orange-600 text-white font-bold rounded-xl hover:bg-orange-700 transition shadow-lg transform hover:scale-105",children:b?"Processing...":"Pay Securely with Razorpay"})]}),c===4&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(N,{className:"w-10 h-10 text-green-600"})}),e.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Application Submitted!"}),e.jsxs("p",{className:"text-gray-600 mb-8 max-w-lg mx-auto",children:["Your application for ",e.jsx("strong",{children:j})," has been successfully placed. Our experts will verify your documents and contact you shortly."]}),e.jsx("button",{onClick:()=>m("/dashboard/user/my-orders"),className:"px-8 py-3 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition",children:"View My Applications"})]})]}),F&&e.jsx("div",{className:"fixed bottom-6 right-6 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-xl z-50 animate-fade-in-up",children:F})]})}export{be as default};
