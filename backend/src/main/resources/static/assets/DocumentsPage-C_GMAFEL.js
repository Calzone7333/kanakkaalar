import{j as e}from"./ui-B7g2UBO6.js";import{r as h}from"./vendor-BMI_syx-.js";import{c as F,g as A,d as g,X as O}from"./index-BDeliUZK.js";import{F as N}from"./file-text-DJ1gVGAi.js";import{D as E}from"./download-B3wrYQZn.js";import{T as H}from"./trash-2-pWo6kbbj.js";import"./utils-Dw7OLvbZ.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],k=F("cloud-upload",J);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M14 4a1 1 0 0 1 1-1",key:"dhj8ez"}],["path",{d:"M15 10a1 1 0 0 1-1-1",key:"1mnyi5"}],["path",{d:"M21 4a1 1 0 0 0-1-1",key:"sfs9ap"}],["path",{d:"M21 9a1 1 0 0 1-1 1",key:"mp6qeo"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5a2 2 0 0 1 2-2h2",key:"15xut4"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}]],C=F("replace",I);function S(m){if(m===0)return"0 Bytes";const x=1024,l=["Bytes","KB","MB","GB","TB"],c=Math.floor(Math.log(m)/Math.log(x));return parseFloat((m/Math.pow(x,c)).toFixed(2))+" "+l[c]}function X(){const m=A(),x=m==null?void 0:m.user,[l,c]=h.useState([]),[u,v]=h.useState(!1),[f,R]=h.useState([]),[y,o]=h.useState(""),[b,D]=h.useState(!1),[r,j]=h.useState(null);h.useEffect(()=>{w()},[]);async function w(){var s,n;D(!0),o("");try{const a=await g.listMyDocs();R(a.data||[])}catch(a){console.warn("Failed to fetch user documents:",a);const t=(s=a==null?void 0:a.response)==null?void 0:s.status,i=(n=a==null?void 0:a.response)==null?void 0:n.data;o(`Could not load documents${t?` (HTTP ${t})`:""}${i?`: ${JSON.stringify(i)}`:""}`)}finally{D(!1)}}async function T(){var s,n;if(!l.length)return o("Please select files to upload.");if(!x||!x.id)return o("Not authenticated. Please login.");v(!0),o("");try{if(r){if(l.length!==1)throw new Error("Only one file can be selected when replacing an existing document.");const a=l[0],t=new FormData;t.append("file",a),t.append("ownerUserId",String(x.id)),await g.replace(r.id,t),o(`✅ Document '${r.filename}' replaced successfully!`),j(null)}else await Promise.all(l.map(async a=>{const t=new FormData;t.append("file",a),t.append("ownerUserId",String(x.id)),await g.upload(t)})),o("✅ Files uploaded successfully!");c([]),await w()}catch(a){console.error("Upload/Replace failed:",a);const t=(s=a==null?void 0:a.response)==null?void 0:s.status,i=(n=a==null?void 0:a.response)==null?void 0:n.data;o(`❌ Action failed${t?` (HTTP ${t})`:""}${i?`: ${JSON.stringify(i)}`:`: ${a==null?void 0:a.message}`}`)}finally{v(!1)}}async function M(s){var n,a;if(window.confirm(`Are you sure you want to delete the document '${s.filename}'? This action cannot be undone.`)){o("");try{await g.deleteDocument(s.id),o(`✅ Document '${s.filename}' deleted successfully.`),await w()}catch(t){console.error("Delete failed:",t);const i=(n=t==null?void 0:t.response)==null?void 0:n.status,d=(a=t==null?void 0:t.response)==null?void 0:a.data;o(`❌ Delete failed${i?` (HTTP ${i})`:""}${d?`: ${JSON.stringify(d)}`:`: ${t==null?void 0:t.message}`}`)}}}async function U(s){var n,a;try{o("");const t=await g.downloadDocument(s.id),i=t.data instanceof Blob?t.data:await t.data.blob(),d=window.URL.createObjectURL(i),p=document.createElement("a");p.href=d,p.download=s.filename||"file",document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(d)}catch(t){console.warn("Failed to download document:",t);const i=(n=t==null?void 0:t.response)==null?void 0:n.status,d=(a=t==null?void 0:t.response)==null?void 0:a.data;o(`Could not download file${i?` (HTTP ${i})`:""}${d?`: ${JSON.stringify(d)}`:""}`)}}function B(s){const n=Array.from(s.target.files||[]);if(r){if(n.length>1){o("Only one file is allowed when replacing a document.");return}c(n)}else{const a=n.filter(t=>!l.some(i=>i.name===t.name&&i.size===t.size));c(t=>[...t,...a])}s.target.value=null}function P(s){c(l.filter(n=>n!==s))}function z(s){j(s),c([]),o(`Ready to replace document: ${s.filename}. Select a new file.`)}function $(){j(null),c([]),o("")}const L=s=>s.startsWith("✅")?"bg-green-100 text-green-800 border-green-200":s.startsWith("❌")||s.toLowerCase().includes("failed")||s.toLowerCase().includes("could not")?"bg-red-100 text-red-800 border-red-200":"bg-blue-100 text-blue-800 border-blue-200";return e.jsx("div",{className:"min-h-screen p-4 sm:p-6 bg-gray-50",children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-extrabold text-gray-900",children:[e.jsx(N,{className:"w-8 h-8 text-indigo-600"}),"Document Center"]}),e.jsx("p",{className:"mt-2 text-gray-500 text-md",children:"Securely manage your uploaded certificates and supporting files."}),y&&e.jsx("div",{className:`mt-4 p-3 text-sm rounded-lg border ${L(y)}`,role:"alert",children:y}),e.jsxs("div",{className:"grid grid-cols-1 gap-8 mt-8 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"p-6 bg-white border border-gray-100 shadow-lg rounded-xl",children:[e.jsx("h2",{className:"pb-3 mb-4 text-xl font-semibold text-gray-800 border-b",children:r?e.jsxs("span",{className:"flex items-center text-orange-500",children:[e.jsx(C,{className:"inline w-5 h-5 mr-2"})," Replace Document"]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx(k,{className:"inline w-5 h-5 mr-2 text-indigo-500"})," New Upload"]})}),r&&e.jsxs("div",{className:"p-3 mb-4 text-sm border border-orange-200 rounded-lg bg-orange-50",children:["**Replacing:** ",r.filename,e.jsx("button",{onClick:$,className:"ml-3 font-medium text-orange-600 hover:text-orange-800",children:"(Cancel)"})]}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-32 transition duration-150 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(k,{className:"w-8 h-8 mb-2 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Click to select file(s)"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-400",children:"PDF, JPG, PNG, up to 10MB each"})]}),e.jsx("input",{id:"file-upload",type:"file",multiple:!r,onChange:B,className:"hidden"})]})}),l.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 text-sm font-medium text-gray-700",children:["Selected File(s) (",l.length,")"]}),e.jsx("ul",{className:"pr-2 space-y-2 overflow-auto max-h-40",children:l.map((s,n)=>e.jsxs("li",{className:"flex items-center justify-between p-2 text-sm border border-indigo-200 rounded bg-indigo-50",children:[e.jsx("span",{className:"flex-1 font-medium text-gray-800 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 ml-4 text-xs text-indigo-600",children:[e.jsx("span",{className:"text-gray-500",children:S(s.size)}),e.jsx("button",{onClick:()=>P(s),className:"p-1 text-red-500 transition rounded-full hover:text-red-700 hover:bg-white",title:"Remove file",disabled:u,children:e.jsx(O,{className:"w-3 h-3"})})]})]},n))})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:T,disabled:u||l.length===0,className:`flex-1 flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm transition duration-150 ease-in-out ${u||l.length===0?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5 mr-3 -ml-1 text-white animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r?"Replacing...":"Uploading..."]}):r?`Replace with ${l.length} File`:`Upload ${l.length} File(s)`}),e.jsx("button",{onClick:r?$:()=>c([]),disabled:u||l.length===0,className:"px-4 py-2 text-gray-700 transition bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50",children:r?"Cancel":"Clear"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"p-6 bg-white border border-gray-100 shadow-lg rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3 mb-4 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Your Documents"}),e.jsx("div",{className:"text-sm font-medium text-indigo-600",children:b?"Loading Documents...":`${f.length} Documents`})]}),b&&e.jsx("div",{className:"py-8 text-center text-gray-500",children:e.jsx("p",{className:"mt-2 text-sm",children:"Fetching your documents..."})}),!b&&f.length===0?e.jsxs("div",{className:"py-10 text-center border border-gray-200 border-dashed rounded-lg bg-gray-50",children:[e.jsx(N,{className:"w-10 h-10 mx-auto text-gray-400"}),e.jsx("p",{className:"mt-3 text-sm font-medium text-gray-500",children:"You haven't uploaded any documents yet."}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Use the panel on the left to get started."})]}):e.jsx("ul",{className:"space-y-4",children:f.map(s=>e.jsxs("li",{className:"flex items-center justify-between p-4 transition duration-150 border border-gray-200 rounded-lg shadow-sm bg-gray-50 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center min-w-0 gap-4",children:[e.jsx(N,{className:"flex-shrink-0 w-6 h-6 text-indigo-500"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",title:s.filename,children:s.filename}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 space-x-2",children:[e.jsx("span",{children:s.contentType||"Unknown Type"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsx("span",{children:s.sizeBytes?S(s.sizeBytes):"—"}),e.jsx("span",{className:"text-gray-300",children:"|"}),e.jsxs("span",{className:"text-gray-500",children:["Uploaded: ",new Date(s.createdAt).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center flex-shrink-0 ml-4 space-x-2",children:[e.jsx("button",{onClick:()=>z(s),className:"flex items-center px-3 py-2 text-sm font-medium text-orange-600 transition duration-150 bg-orange-100 rounded-lg hover:bg-orange-200",title:"Replace Document",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(s),className:"flex items-center px-3 py-2 text-sm font-medium text-white transition duration-150 bg-green-600 rounded-lg shadow-md hover:bg-green-700",title:"Download",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(s),className:"flex items-center px-3 py-2 text-sm font-medium text-red-600 transition duration-150 bg-red-100 rounded-lg hover:bg-red-200",title:"Delete Document",children:e.jsx(H,{className:"w-4 h-4"})})]})]},s.id))})]})})]}),e.jsx("div",{className:"pt-4 mt-8 text-center border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["By uploading documents you confirm you have the right to share them with our platform. Sensitive information will be handled in accordance with our ",e.jsx("a",{href:"#",className:"text-indigo-600 hover:underline",children:"privacy policy"}),"."]})})]})})}export{X as default};
