import{j as e}from"./ui-Ch41-bI7.js";import{r}from"./vendor-Con1GFA2.js";import{o as E,u as U,h as _}from"./index-DOyQY1V8.js";import{F}from"./XMarkIcon-D4kwBmWa.js";import{b as B,F as R,a as I}from"./UserIcon-6DteX0uI.js";import{F as G,a as V}from"./PhoneIcon-D8Hr4Amr.js";import{F as P}from"./DocumentTextIcon-CxGPquyn.js";import{F as z}from"./ArrowDownTrayIcon-CCQMWziE.js";import{F as M}from"./UserPlusIcon-C5LrMZAn.js";import"./utils-BMGruD9E.js";function W({title:a,titleId:i,...o},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":i},o),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}const O=r.forwardRef(W);function Z({title:a,titleId:i,...o},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":i},o),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Y=r.forwardRef(Z);function K({title:a,titleId:i,...o},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":i},o),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const q=r.forwardRef(K);function H({title:a,titleId:i,...o},d){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":i},o),a?r.createElement("title",{id:i},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const J=r.forwardRef(H);function Q({order:a,onClose:i,onAssigned:o}){var c;const[d,A]=r.useState([]),[h,x]=r.useState([]),[p,u]=r.useState(null),[C,b]=r.useState(!0),[f,w]=r.useState(!1),[g,v]=r.useState(a.assigneeEmail||""),[j,N]=r.useState(null);r.useEffect(()=>{(async()=>{b(!0);try{const n=await E.listDocuments(a.id);if(A(n.data||[]),a.userId)try{const l=await U.getById(a.userId);u(l.data)}catch(l){console.warn("Could not fetch user details:",l),u({email:a.customerEmail,fullName:"Customer",phone:"N/A"})}try{const l=await _.listEmployees();console.log("AdminOrderDetailModal: Fetched employees response:",l);let m=[];l.data&&Array.isArray(l.data.employees)?m=l.data.employees:Array.isArray(l.data)&&(m=l.data),console.log("AdminOrderDetailModal: Parsed employees list:",m),x(m)}catch(l){console.error("AdminOrderDetailModal: Could not fetch employees:",l),x([])}}catch(n){console.error("Error fetching order details:",n)}finally{b(!1)}})()},[a.id,a.userId,a.customerEmail]);const S=async s=>{N(s);try{const n=await E.downloadDocument(a.id,s),l=d.find($=>$.id===s),m=(l==null?void 0:l.fileName)||`document-${s}`,T=new Blob([n.data],{type:n.headers["content-type"]||"application/octet-stream"}),k=window.URL.createObjectURL(T),y=document.createElement("a");y.href=k,y.download=m,document.body.appendChild(y),y.click(),y.remove(),window.URL.revokeObjectURL(k)}catch(n){console.error("Error downloading document:",n),alert("Failed to download document")}finally{N(null)}},D=async()=>{if(!g){alert("Please select an employee");return}w(!0);try{const s=await E.assign(a.id,{assigneeEmail:g});o&&o(s.data),i()}catch(s){console.error("Error assigning order:",s),alert("Failed to assign order")}finally{w(!1)}},L=s=>{var l;const n=((l=s==null?void 0:s.split(".").pop())==null?void 0:l.toLowerCase())||"";return["pdf"].includes(n)?e.jsx("span",{className:"text-red-600",children:"ðŸ“„"}):["doc","docx"].includes(n)?e.jsx("span",{className:"text-blue-600",children:"ðŸ“"}):["xls","xlsx","csv"].includes(n)?e.jsx("span",{className:"text-green-600",children:"ðŸ“Š"}):["jpg","jpeg","png","gif"].includes(n)?e.jsx("span",{className:"text-purple-600",children:"ðŸ–¼ï¸"}):e.jsx("span",{className:"text-gray-600",children:"ðŸ“Ž"})},t=s=>{if(!s)return"0 B";const n=1024,l=["B","KB","MB","GB"],m=Math.floor(Math.log(s)/Math.log(n));return Math.round(s/Math.pow(n,m)*100)/100+" "+l[m]};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 flex items-center justify-between px-6 py-4 border-b bg-gradient-to-r from-blue-600 to-indigo-600",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:["Order #",a.id]}),e.jsx("button",{onClick:i,className:"p-1 transition rounded-lg hover:bg-blue-700",children:e.jsx(F,{className:"w-6 h-6 text-white"})})]}),e.jsx("div",{className:"p-6 space-y-6",children:C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 mb-4 bg-blue-100 rounded-full animate-pulse",children:e.jsx(B,{className:"w-6 h-6 text-blue-600"})}),e.jsx("p",{className:"text-gray-600",children:"Loading order details..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 border border-blue-200 rounded-lg bg-blue-50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold text-gray-600",children:"Service"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:a.serviceName||"N/A"})]}),e.jsxs("div",{className:"p-4 border border-green-200 rounded-lg bg-green-50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold text-gray-600",children:"Order Value"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["â‚¹",(a.totalAmount||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"p-4 border border-purple-200 rounded-lg bg-purple-50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold text-gray-600",children:"Status"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:((c=a.status)==null?void 0:c.replace(/_/g," "))||"Unknown"})]}),e.jsxs("div",{className:"p-4 border border-orange-200 rounded-lg bg-orange-50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold text-gray-600",children:"Created On"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:a.createdAt?new Date(a.createdAt).toLocaleDateString("en-IN"):"N/A"})]})]}),p&&e.jsxs("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4 text-lg font-bold text-gray-900",children:[e.jsx(R,{className:"w-5 h-5 text-blue-600"}),"Customer Information"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-4 h-4 mt-1 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:p.fullName||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(G,{className:"w-4 h-4 mt-1 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Email"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 break-all",children:p.email||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(V,{className:"w-4 h-4 mt-1 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Phone"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:p.phone||"N/A"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4 text-lg font-bold text-gray-900",children:[e.jsx(P,{className:"w-5 h-5 text-indigo-600"}),"Documents (",d.length,")"]}),d.length>0?e.jsx("div",{className:"space-y-2",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 transition border border-gray-200 rounded-lg bg-gray-50 hover:border-gray-300",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0 gap-3",children:[e.jsx("div",{className:"flex-shrink-0 text-xl",children:L(s.fileName)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.fileName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx("span",{children:t(s.size)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(s.uploadedAt).toLocaleDateString("en-IN")}),s.verified&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-green-600",children:[e.jsx(I,{className:"w-3 h-3"}),"Verified"]})]})]})]})]}),e.jsxs("button",{onClick:()=>S(s.id),disabled:j===s.id,className:"flex items-center flex-shrink-0 gap-1 px-3 py-2 ml-3 text-sm font-medium text-indigo-600 transition rounded-lg hover:text-indigo-700 hover:bg-indigo-50 disabled:opacity-50",children:[e.jsx(z,{className:"w-4 h-4"}),j===s.id?"...":"Download"]})]},s.id))}):e.jsx("p",{className:"py-4 text-sm text-center text-gray-500",children:"No documents uploaded"})]}),e.jsxs("div",{className:"p-4 border border-indigo-200 rounded-lg bg-indigo-50",children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4 text-lg font-bold text-gray-900",children:[e.jsx(M,{className:"w-5 h-5 text-indigo-600"}),"Assign Order to Employee"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 text-sm font-semibold text-gray-700",children:"Select Employee"}),h.length>0?e.jsxs("select",{value:g,onChange:s=>v(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Choose an employee..."}),h.map(s=>e.jsxs("option",{value:s.email,children:[s.fullName," (",s.email,")"]},s.id))]}):e.jsx("p",{className:"p-3 text-sm text-gray-600 bg-white border border-gray-200 rounded-lg",children:"No employees available. Please create employees first."})]}),a.assigneeEmail&&e.jsxs("div",{className:"p-3 bg-white border border-indigo-200 rounded-lg",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold text-gray-600",children:"Currently Assigned To"}),e.jsx("p",{className:"text-sm font-medium text-indigo-600",children:a.assigneeEmail})]}),e.jsxs("button",{onClick:D,disabled:f||!g||h.length===0,className:"flex items-center justify-center w-full gap-2 px-4 py-2 font-medium text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(M,{className:"w-5 h-5"}),f?"Assigning...":"Assign Order"]})]})]})]})})]})})}function de(){const[a,i]=r.useState([]),[o,d]=r.useState([]),[A,h]=r.useState(!0),[x,p]=r.useState(""),[u,C]=r.useState("ALL"),[b,f]=r.useState(null),[w,g]=r.useState(!1),[v,j]=r.useState(!1),N=async()=>{j(!0);try{const t=await E.getAll();i(t.data||[])}catch(t){console.error("Error fetching orders:",t)}finally{j(!1)}};r.useEffect(()=>{h(!0),N().finally(()=>h(!1))},[]),r.useEffect(()=>{let t=a;x&&(t=t.filter(c=>{var s,n,l;return((s=c.id)==null?void 0:s.toString().includes(x))||((n=c.customerEmail)==null?void 0:n.toLowerCase().includes(x.toLowerCase()))||((l=c.serviceName)==null?void 0:l.toLowerCase().includes(x.toLowerCase()))})),u!=="ALL"&&(t=t.filter(c=>c.status===u)),d(t)},[x,u,a]);const S={CREATED:"bg-blue-100 text-blue-800",DOCUMENTS_PENDING:"bg-yellow-100 text-yellow-800",DOCUMENTS_VERIFIED:"bg-purple-100 text-purple-800",PAYMENT_COMPLETED:"bg-green-100 text-green-800",ASSIGNED:"bg-indigo-100 text-indigo-800",IN_PROGRESS:"bg-orange-100 text-orange-800",COMPLETED:"bg-emerald-100 text-emerald-800",CANCELLED:"bg-red-100 text-red-800"},D=t=>{switch(t){case"PAYMENT_COMPLETED":case"DOCUMENTS_VERIFIED":case"COMPLETED":return e.jsx(I,{className:"w-4 h-4"});case"CANCELLED":return e.jsx(F,{className:"w-4 h-4"});default:return e.jsx(O,{className:"w-4 h-4"})}},L=t=>{f(t),g(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Orders Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage all orders and assign them to employees"})]}),e.jsxs("button",{onClick:()=>{j(!0),N()},disabled:v,className:"flex items-center gap-2 px-4 py-2 text-white transition bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(O,{className:`w-5 h-5 ${v?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute w-5 h-5 text-gray-400 top-3 left-3"}),e.jsx("input",{type:"text",placeholder:"Search by Order ID, Email, or Service...",value:x,onChange:t=>p(t.target.value),className:"w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute w-5 h-5 text-gray-400 top-3 left-3"}),e.jsxs("select",{value:u,onChange:t=>C(t.target.value),className:"w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),e.jsx("option",{value:"CREATED",children:"Created"}),e.jsx("option",{value:"DOCUMENTS_PENDING",children:"Documents Pending"}),e.jsx("option",{value:"DOCUMENTS_VERIFIED",children:"Documents Verified"}),e.jsx("option",{value:"PAYMENT_COMPLETED",children:"Payment Completed"}),e.jsx("option",{value:"ASSIGNED",children:"Assigned"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[o.length," of ",a.length," orders"]})})]}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 mb-4 bg-blue-100 rounded-full animate-pulse",children:e.jsx(O,{className:"w-6 h-6 text-blue-600"})}),e.jsx("p",{className:"text-gray-600",children:"Loading orders..."})]})}):o.length===0?e.jsx("div",{className:"flex items-center justify-center py-12 bg-white border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No orders found"})]})}):e.jsx("div",{className:"overflow-hidden bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Service"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Assigned To"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-xs font-semibold text-left text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:o.map(t=>{var c;return e.jsxs("tr",{className:"transition border-b border-gray-200 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-semibold text-gray-900",children:["#",t.id]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.jsx("div",{children:t.customerEmail})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.serviceName||"N/A"}),e.jsxs("td",{className:"px-6 py-4 text-sm font-medium text-green-600",children:["â‚¹",(t.totalAmount||0).toLocaleString("en-IN")]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 text-xs font-semibold rounded-full ${S[t.status]||"bg-gray-100 text-gray-800"}`,children:[D(t.status),((c=t.status)==null?void 0:c.replace(/_/g," "))||"Unknown"]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:t.assigneeEmail?e.jsxs("div",{className:"flex items-center gap-2 font-medium text-indigo-600",children:[e.jsx(R,{className:"w-4 h-4"}),t.assigneeEmail]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Unassigned"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("en-IN"):"N/A"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{onClick:()=>L(t),className:"flex items-center gap-2 px-3 py-1 text-sm font-medium text-white transition bg-blue-600 rounded-lg hover:bg-blue-700",children:[e.jsx(Y,{className:"w-4 h-4"}),"View"]})})]},t.id)})})]})})}),w&&b&&e.jsx(Q,{order:b,onClose:()=>{g(!1),f(null)},onAssigned:t=>{i(a.map(c=>c.id===t.id?t:c)),g(!1),f(null)}})]})}export{de as default};
