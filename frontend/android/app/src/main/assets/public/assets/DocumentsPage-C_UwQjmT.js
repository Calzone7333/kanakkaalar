import{j as e}from"./ui-Ch41-bI7.js";import{r as m}from"./vendor-Con1GFA2.js";import{c as k,g as F,e as p}from"./index-SiRpZdc4.js";import{F as v}from"./file-text-Dslcny1G.js";import{D as L}from"./download-DzpwpDIc.js";import{T as P}from"./trash-2-i4V96l9G.js";import"./utils-BMGruD9E.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],A=k("cloud-upload",B);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M14 4a1 1 0 0 1 1-1",key:"dhj8ez"}],["path",{d:"M15 10a1 1 0 0 1-1-1",key:"1mnyi5"}],["path",{d:"M21 4a1 1 0 0 0-1-1",key:"sfs9ap"}],["path",{d:"M21 9a1 1 0 0 1-1 1",key:"mp6qeo"}],["path",{d:"m3 7 3 3 3-3",key:"x25e72"}],["path",{d:"M6 10V5a2 2 0 0 1 2-2h2",key:"15xut4"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}]],z=k("replace",O);function E(d){if(d===0)return"0 Bytes";const u=1024,i=["Bytes","KB","MB","GB","TB"],c=Math.floor(Math.log(d)/Math.log(u));return parseFloat((d/Math.pow(u,c)).toFixed(2))+" "+i[c]}function K(){const d=F(),u=d==null?void 0:d.user,[i,c]=m.useState([]),[y,b]=m.useState(!1),[w,D]=m.useState([]),[h,l]=m.useState(""),[$,j]=m.useState(!1),[f,N]=m.useState(null);m.useEffect(()=>{g()},[]);async function g(){var s,o;j(!0),l("");try{const a=await p.listMyDocs();D(a.data||[])}catch(a){console.warn("Failed to fetch user documents:",a);const t=(s=a==null?void 0:a.response)==null?void 0:s.status,n=(o=a==null?void 0:a.response)==null?void 0:o.data;l(`Could not load documents${t?` (HTTP ${t})`:""}${n?`: ${JSON.stringify(n)}`:""}`)}finally{j(!1)}}async function S(){var s,o;if(!i.length)return l("Please select files to upload.");if(!u||!u.id)return l("Not authenticated. Please login.");b(!0),l("");try{if(f){if(i.length!==1)throw new Error("Only one file can be selected when replacing an existing document.");const a=i[0],t=new FormData;t.append("file",a),t.append("ownerUserId",String(u.id)),await p.replace(f.id,t),l(`✅ Document '${f.filename}' replaced successfully!`),N(null)}else await Promise.all(i.map(async a=>{const t=new FormData;t.append("file",a),t.append("ownerUserId",String(u.id)),await p.upload(t)})),l("✅ Files uploaded successfully!");c([]),await g()}catch(a){console.error("Upload/Replace failed:",a);const t=(s=a==null?void 0:a.response)==null?void 0:s.status,n=(o=a==null?void 0:a.response)==null?void 0:o.data;l(`❌ Action failed${t?` (HTTP ${t})`:""}${n?`: ${JSON.stringify(n)}`:`: ${a==null?void 0:a.message}`}`)}finally{b(!1)}}async function T(s){var o,a;if(window.confirm(`Are you sure you want to delete the document '${s.filename}'? This action cannot be undone.`)){l("");try{await p.deleteDocument(s.id),l(`✅ Document '${s.filename}' deleted successfully.`),await g()}catch(t){console.error("Delete failed:",t);const n=(o=t==null?void 0:t.response)==null?void 0:o.status,r=(a=t==null?void 0:t.response)==null?void 0:a.data;l(`❌ Delete failed${n?` (HTTP ${n})`:""}${r?`: ${JSON.stringify(r)}`:`: ${t==null?void 0:t.message}`}`)}}}async function M(s){var o,a;try{l("");const t=await p.downloadDocument(s.id),n=t.data instanceof Blob?t.data:await t.data.blob(),r=window.URL.createObjectURL(n),x=document.createElement("a");x.href=r,x.download=s.filename||"file",document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(r)}catch(t){console.warn("Failed to download document:",t);const n=(o=t==null?void 0:t.response)==null?void 0:o.status,r=(a=t==null?void 0:t.response)==null?void 0:a.data;l(`Could not download file${n?` (HTTP ${n})`:""}${r?`: ${JSON.stringify(r)}`:""}`)}}function C(s){const o=Array.from(s.target.files||[]);if(f){if(o.length>1){l("Only one file is allowed when replacing a document.");return}c(o)}else{const a=o.filter(t=>!i.some(n=>n.name===t.name&&n.size===t.size));c(t=>[...t,...a])}s.target.value=null}function U(s){N(s),c([]),l(`Ready to replace document: ${s.filename}. Select a new file.`)}const R=s=>s.startsWith("✅")?"bg-green-100 text-green-800 border-green-200":s.startsWith("❌")||s.toLowerCase().includes("failed")||s.toLowerCase().includes("could not")?"bg-red-100 text-red-800 border-red-200":"bg-blue-100 text-blue-800 border-blue-200";return e.jsx("div",{className:"min-h-screen bg-white",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Documents"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your certificates and files."})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"relative w-full md:w-96",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(v,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border-none rounded-full bg-gray-100 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-0 sm:text-sm",placeholder:"Search documents..."})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("button",{className:"text-gray-900 font-bold text-sm border-b-2 border-black pb-1",children:"All"}),e.jsx("button",{className:"text-gray-500 font-medium text-sm hover:text-gray-700 pb-1",children:"Recent"}),e.jsx("button",{className:"text-gray-500 font-medium text-sm hover:text-gray-700 pb-1",children:"Starred"})]})]}),h&&e.jsx("div",{className:`mb-6 p-4 rounded-lg text-sm ${R(h)}`,children:h}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-100 border-dashed rounded-xl cursor-pointer hover:bg-gray-50 transition",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(A,{className:"w-8 h-8 text-gray-300 mb-2"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold text-indigo-600",children:"Click to upload"})," or drag and drop"]})]}),e.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:C})]}),i.length>0&&e.jsxs("div",{className:"mt-4 flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Selected: ",i.length," file(s)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c([]),className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear"}),e.jsx("button",{onClick:S,disabled:y,className:"bg-black text-white text-sm px-4 py-1.5 rounded-full hover:bg-gray-800 disabled:opacity-50",children:y?"Uploading...":"Upload Now"})]})]})]}),e.jsx("div",{className:"space-y-1",children:$?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"Loading..."}):w.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"No documents found."}):w.map(s=>e.jsxs("div",{className:"group flex items-center justify-between py-4 px-2 hover:bg-gray-50 rounded-lg transition",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-red-50 flex items-center justify-center text-red-500",children:e.jsx(v,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-900",children:s.filename}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:[s.contentType||"PDF"," • ",s.sizeBytes?E(s.sizeBytes):"Unknown"," • ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>M(s),className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full",title:"Download",children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(s),className:"p-2 text-gray-400 hover:text-orange-600 hover:bg-orange-50 rounded-full",title:"Replace",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(s),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full",title:"Delete",children:e.jsx(P,{className:"h-4 w-4"})})]})]},s.id))})]})})}export{K as default};
