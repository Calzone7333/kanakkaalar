import{j as e,m as y,A as B}from"./ui-Ch41-bI7.js";import{r as o,b as F,L as G}from"./vendor-Con1GFA2.js";import{a as P,s as C}from"./index-SiRpZdc4.js";import{A as Y}from"./AppBackButton-BS7bEBpR.js";import"./utils-BMGruD9E.js";function X(){const[x,L]=o.useState(""),[v,T]=o.useState(""),[f,A]=o.useState(""),[j,E]=o.useState(""),[g,S]=o.useState("password"),[c,N]=o.useState(!1),[b,m]=o.useState(!1),[w,l]=o.useState(null),[O,k]=o.useState(null),[R,M]=o.useState(!1),[q,D]=o.useState(!1),r=F(),$=async a=>{var i,d,s,p,h,n;if(a.preventDefault(),!x||!v)return l("Enter email and password");m(!0);try{const t=await P.login({email:x,password:v});C(t.data),window.dispatchEvent(new Event("auth:update"));const u=((i=t.data.user)==null?void 0:i.role)||"USER";u==="ADMIN"?r("/dashboard/admin",{replace:!0}):u==="EMPLOYEE"?r("/dashboard/employee",{replace:!0}):u==="AGENT"?r("/dashboard/agent",{replace:!0}):r("/dashboard/user",{replace:!0})}catch(t){const u=((s=(d=t==null?void 0:t.response)==null?void 0:d.data)==null?void 0:s.message)||((h=(p=t==null?void 0:t.response)==null?void 0:p.data)==null?void 0:h.error)||(t==null?void 0:t.message)||"Login failed";l(u);const V=((n=t==null?void 0:t.response)==null?void 0:n.status)===401||/invalid|incorrect|credentials|not found/i.test(u);M(V),/email not verified/i.test(u)&&D(!0)}finally{m(!1)}},I=async a=>{var i,d;if(a.preventDefault(),!/^[0-9+\-() ]{7,20}$/.test(f))return l("Enter a valid phone number");m(!0);try{const s=await P.loginPhone({phone:f});k(s.data.code||""),N(!0),l("OTP sent successfully!")}catch(s){l(((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.error)||(s==null?void 0:s.message)||"Failed to send OTP")}finally{m(!1)}},U=async a=>{var i,d,s,p,h;if(a.preventDefault(),!j)return l("Enter OTP");m(!0);try{const n=await P.verifyPhone({phone:f,code:j});C(n.data),window.dispatchEvent(new Event("auth:update"));const t=((i=n.data.user)==null?void 0:i.role)||"USER";t==="ADMIN"?r("/dashboard/admin",{replace:!0}):t==="EMPLOYEE"?r("/dashboard/employee",{replace:!0}):t==="AGENT"?r("/dashboard/agent",{replace:!0}):r("/dashboard/user",{replace:!0})}catch(n){l(((s=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:s.message)||((h=(p=n==null?void 0:n.response)==null?void 0:p.data)==null?void 0:h.error)||"OTP verification failed")}finally{m(!1)}};return e.jsxs("div",{className:"flex items-center justify-center min-h-screen relative",children:[e.jsx(Y,{}),e.jsxs(y.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative w-full max-w-md p-8 bg-white shadow-2xl rounded-2xl",children:[e.jsx("h2",{className:"mb-6 text-3xl font-bold text-center text-[#003366]",children:"Welcome Back ðŸ‘‹"}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{className:`flex-1 py-2 rounded-lg font-medium transition ${g==="password"?"bg-[#003366] text-white shadow-md":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,onClick:()=>{S("password"),N(!1),l(null)},children:"Email Login"}),e.jsx("button",{className:`flex-1 py-2 rounded-lg font-medium transition ${g==="phone"?"bg-[#003366] text-white shadow-md":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,onClick:()=>{S("phone"),l(null)},children:"Phone OTP"})]}),e.jsx(B,{mode:"wait",children:g==="password"?e.jsxs(y.form,{onSubmit:$,initial:{opacity:0,x:-30},animate:{opacity:1,x:0},exit:{opacity:0,x:30},className:"space-y-4",autoComplete:"on",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Email"}),e.jsx("input",{type:"email",value:x,onChange:a=>L(a.target.value),className:"mt-1 w-full border border-slate-300 px-3 py-2 rounded-lg focus:ring-[#003366] focus:border-[#003366] outline-none",placeholder:"you@example.com",name:"username",autoComplete:"username",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Password"}),e.jsx("input",{type:"password",value:v,onChange:a=>T(a.target.value),className:"mt-1 w-full border border-slate-300 px-3 py-2 rounded-lg focus:ring-[#003366] focus:border-[#003366] outline-none",placeholder:"Your password",name:"current-password",autoComplete:"current-password",required:!0})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-[#003366] text-white py-2 rounded-lg transition-all hover:bg-[#002244] disabled:bg-slate-400 shadow-md",children:b?"Signing in...":"Sign in"})]},"password-login"):e.jsxs(y.form,{onSubmit:c?U:I,initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Phone"}),e.jsx("input",{value:f,onChange:a=>A(a.target.value),disabled:c,className:`mt-1 w-full border border-slate-300 px-3 py-2 rounded-lg focus:ring-[#003366] focus:border-[#003366] outline-none ${c?"bg-slate-50":""}`,placeholder:"e.g. 9876543210"})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Enter OTP"}),e.jsx("input",{type:"text",inputMode:"numeric",value:j,onChange:a=>E(a.target.value),maxLength:"6",className:"w-full border border-slate-300 px-3 py-2 rounded-lg focus:ring-[#003366] focus:border-[#003366] outline-none text-center text-2xl tracking-widest",placeholder:"000000"}),O&&e.jsxs("div",{className:"p-3 text-sm text-center text-blue-800 border border-blue-200 rounded-lg bg-blue-50",children:["OTP: ",e.jsx("span",{className:"font-bold text-[#003366]",children:O})]})]}),e.jsx("button",{type:"submit",disabled:b,className:"w-full bg-[#003366] text-white py-2 rounded-lg transition-all hover:bg-[#002244] disabled:bg-slate-400 shadow-md",children:b?c?"Verifying...":"Sending...":c?"Verify OTP":"Send OTP"}),c&&e.jsx("button",{type:"button",onClick:()=>{N(!1),E(""),k(null),l(null)},className:"w-full border border-[#003366] text-[#003366] py-2 rounded-lg transition-all hover:bg-blue-50",children:"Use Different Phone"})]},"phone-login")}),w&&e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},className:`mt-5 p-3 rounded-lg text-sm text-center shadow-sm ${w.includes("success")||w.includes("sent")?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:[w,R&&g==="password"&&e.jsx("div",{className:"mt-3 text-sm",children:e.jsx(G,{to:`/forgot-password?email=${encodeURIComponent(x)}`,className:"text-[#003366] font-medium hover:underline",children:"Forgot password? Reset here"})})]})]})]})}export{X as default};
