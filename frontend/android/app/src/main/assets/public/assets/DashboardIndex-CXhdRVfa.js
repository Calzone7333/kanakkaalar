import{j as e}from"./ui-Ch41-bI7.js";import{r as l,b as L}from"./vendor-Con1GFA2.js";import{g as k,o as g}from"./index-SiRpZdc4.js";import"./utils-BMGruD9E.js";function Y(){const[d,o]=l.useState([]),[C,h]=l.useState(!1),[y,x]=l.useState(null),[b,i]=l.useState(null),[O,S]=l.useState(!1),w=L();return l.useEffect(()=>{const a=k(),s=a==null?void 0:a.user;if(!s){w("/login");return}const c=a==null?void 0:a.token;if(S(!!c),!c){i("No auth token found. Please login to view your orders."),o([]),h(!1);return}let n=!0;return(async()=>{var j,p,N,A,v;x(null),i(null),h(!0);try{const r=await g.myOrders(),u=Array.isArray((j=r==null?void 0:r.data)==null?void 0:j.data)?r.data.data:Array.isArray(r==null?void 0:r.data)?r.data:Array.isArray((p=r==null?void 0:r.data)==null?void 0:p.orders)?r.data.orders:[];n&&o(u)}catch(r){if((r==null?void 0:r.code)==="ERR_NETWORK"||r!=null&&r.message&&r.message.toLowerCase().includes("network"))try{const t=await g.getAll(),f=Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray((N=t==null?void 0:t.data)==null?void 0:N.data)?t.data.data:[];if(!n)return;f.length>0?(o(f),i("Loaded public orders as a fallback. Your user-specific orders endpoint failed to reach the backend.")):(o([]),i("Could not reach backend. Showing no orders."));return}catch{if(!n)return;o([]),i("Could not reach backend. Showing no orders.");return}const u=(A=r==null?void 0:r.response)==null?void 0:A.status;if(u===401||u===403)try{const t=await g.getAll(),E=(Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray((v=t==null?void 0:t.data)==null?void 0:v.data)?t.data.data:[]).filter(m=>m.userId&&(s!=null&&s.id)?Number(m.userId)===Number(s.id):m.customerEmail&&(s!=null&&s.email)?String(m.customerEmail).toLowerCase()===String(s.email).toLowerCase():!1);if(!n)return;o(E),i(E.length>0?"Loaded matching orders from public list (auth endpoint failed).":"No matching orders found in public list.");return}catch{if(!n)return;x(new Error("Authentication error. Please login again."));return}n&&x(r)}finally{n&&h(!1)}})(),()=>{n=!1}},[]),C?e.jsxs("div",{className:"flex items-center justify-center h-64 text-gray-500",children:[e.jsxs("svg",{className:"w-6 h-6 mr-3 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading your orders..."]}):y&&!(Array.isArray(d)&&d.length>0)?e.jsxs("div",{className:"p-4 text-red-700 bg-red-100 border border-red-400 rounded",children:["❌ Error fetching your orders: ",y.message||"Unknown error",".",e.jsx("br",{}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-3 px-3 py-1 bg-[#003366] text-white rounded hover:bg-[#002244]",children:"Retry"})]}):e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between pb-2 border-b",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"My Orders"})}),b&&e.jsx("div",{className:"p-3 my-4 text-sm text-yellow-800 border border-yellow-200 rounded bg-yellow-50",children:b}),Array.isArray(d)&&d.length>0?e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3",children:d.map(a=>{var s,c;return e.jsxs("div",{className:"relative p-6 transition-all duration-200 bg-white border border-gray-200 rounded-xl shadow-lg hover:shadow-xl hover:ring-2 hover:ring-[#0080FF] cursor-pointer",children:[e.jsx("h3",{className:"text-xl font-extrabold text-[#0080FF]",children:a.serviceName||"Untitled Service"}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",a.id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",a.customerEmail||((c=(s=k())==null?void 0:s.user)==null?void 0:c.email)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ml-2 ${a.status==="PAYMENT_COMPLETED"?"bg-green-100 text-green-800":a.status==="CREATED"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:a.status})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ₹",a.totalAmount]})]})]},a.id)})}):e.jsxs("div",{className:"p-6 text-center text-gray-500 bg-white border border-dashed rounded-lg",children:[e.jsx("p",{className:"text-lg",children:"You don’t have any orders yet."}),e.jsx("button",{onClick:()=>w("/dashboard/user/servicehub"),className:"mt-4 px-4 py-2 text-sm font-semibold text-white bg-[#0080FF] rounded-lg hover:bg-[#0066CC] transition",children:"Explore Services"})]})]})}export{Y as default};
